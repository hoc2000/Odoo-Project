<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal_my_home" name="Ticket" inherit_id="portal.portal_my_home" customize_show="True">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="url">/my/ticket</t>
                <t t-set="title">Ticket</t>
                <t t-set="placeholder_count" t-value="'ticket_count'"/>
            </t>
        </xpath>
    </template>

    <template id="portal_breadcrumbs" name="Ticket layout: project menu entry" inherit_id="portal.portal_breadcrumbs"
              priority="40">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'ticket_list' or project" class="breadcrumb-item">
                Tickets
            </li>
            <li t-if="page_name == 'ticket_detail_view'" class="breadcrumb-item">
                <a href="/my/ticket">Tickets</a>
                <span t-out="ticket.name"/>
            </li>
        </xpath>
    </template>
    <!--    List view-->
    <template id="portal_ticket_list_view_customer" name="Ticket List">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Ticket Mockdesk</t>
            </t>
            <t t-call="portal.portal_table">
                <thead class="thead-dark" data-oe-model="ir.ui.view"
                       style="background-color: #a183aa;color: white;">
                    <tr>
                        <th class="text-center">Reference</th>
                        <th class="text-center">Ticket Name</th>
                        <th class="text-center">Assign To</th>
                        <th class="text-center">Priority</th>
                        <th class="text-center">Stage</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="tickets" t-as="ticket">
                        <tr>
                            <!--Lấy id bằng cách này , đọc kĩ cả bên controller portal nữa-->
                            <td class="text-center">
                                <a t-attf-href="/my/ticket/#{ticket.id}" style="color:blue">
                                    <t t-out="ticket.ref"/>
                                </a>
                            </td>
                            <td class="">
                                <t t-out="ticket.name"/>
                            </td>
                            <td class="text-center">
                                <t t-out="ticket.assign_to.name"/>
                            </td>
                            <td class="text-center">
                                <t t-if="ticket.priority == '0' ">
                                    Not Rated
                                </t>
                                <t t-if="ticket.priority == '1' ">
                                    Minor
                                </t>
                                <t t-if="ticket.priority == '2' ">
                                    Major
                                </t>
                                <t t-if="ticket.priority == '3' ">
                                    Critical
                                </t>

                            </td>
                            <td class="text-center">
                                <span t-out="ticket.stage_id.name"
                                      t-if="ticket.is_closed"
                                      class=" badge rounded-pill text-bg-danger"/>
                                <span t-out="ticket.stage_id.name"
                                      t-else=""
                                      class=" badge rounded-pill text-bg-info"/>
                            </td>
                        </tr>
                    </t>
                </tbody>
            </t>
        </t>
    </template>

    <!--    Detail-view-->
    <template id="portal_ticket_detail_view" inherit_id="portal.portal_sidebar" primary="True">
        <xpath expr="//div[hasclass('o_portal_sidebar')]" position="inside">
            <t t-if="page_name == 'ticket_detail_view'">
                <section>
                    <div class="container py-5 inform-detail">
                        <div class="row">
                            <div class="col-lg-4">
                                <div class="card mb-4">
                                    <ul class="list-group list-group-flush flex-wrap flex-row flex-lg-column">
                                        <!-- Assign and customer sidebar-->
                                        <li t-if="ticket.assign_to or ticket.customer_id"
                                            class="list-group-item flex-grow-1">
                                            <div class="col-12 col-md-12 py-2" t-if="ticket.assign_to">
                                                <strong>Assigned to</strong>
                                                <div class="d-flex ps-3 flex-nowrap mt-1">
                                                    <img class="rounded-circle o_portal_contact_img"
                                                         t-att-src="image_data_uri(ticket.assign_to.avatar_128)"
                                                         alt="Contact"/>
                                                    <div class="ms-2">
                                                        <div t-out="ticket.assign_to"
                                                             t-options="{'widget': 'contact', 'fields': ['name']}"
                                                             class="mt-2"/>
                                                        <a t-attf-href="mailto:{{ticket.assign_to.email}}"
                                                           t-if="ticket.assign_to.email">
                                                            <div t-field="ticket.assign_to"
                                                                 t-options="{'widget': 'contact', 'fields': ['email']}"/>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-12 py-2" t-else="">
                                                <p>Not assign yet</p>
                                            </div>
                                            <hr/>
                                            <div class="col-12 col-md-12 py-2" t-if="ticket.customer_id">
                                                <strong>Customer</strong>
                                                <div class="d-flex ps-3 flex-nowrap mt-1">
                                                    <img class="rounded-circle o_portal_contact_img"
                                                         t-att-src="image_data_uri(ticket.customer_id.avatar_128)"
                                                         alt="Contact"/>
                                                    <div class="ms-2">
                                                        <div t-field="ticket.customer_id"
                                                             t-options="{'widget': 'contact', 'fields': ['name']}"/>
                                                        <a t-attf-href="mailto:{{ticket.customer_id.email}}"
                                                           t-if="ticket.customer_id.email">
                                                            <div t-field="ticket.customer_id"
                                                                 t-options="{'widget': 'contact', 'fields': ['email']}"/>
                                                        </a>
                                                        <a t-attf-href="tel:{{ticket.customer_id.phone}}"
                                                           t-if="ticket.customer_id.phone">
                                                            <div t-field="ticket.customer_id"
                                                                 t-options="{'widget': 'contact', 'fields': ['phone']}"/>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        <!-- Button-->
                                        <li class="list-group-item flex-grow-1">
                                            <div class="d-flex justify-content-center px-2">
                                                <div t-if=" not ticket.is_closed"
                                                     class="d-grid flex-sm-nowrap mx-2">
                                                    <button class="btn btn-danger pt-1"
                                                            data-bs-target="#mockdesk_ticket_close_modal"
                                                            data-bs-toggle="modal"
                                                            style="color:white;">
                                                        Close Ticket
                                                    </button>
                                                </div>
                                                <div class="d-grid flex-sm-nowrap mx-2">
                                                    <button class="btn btn-primary pt-1">
                                                        <a t-attf-href="/my/ticket/print/#{ticket.id}"
                                                           class="fa fa-file-pdf-o"
                                                           style="color:white;"
                                                           target="_blank">
                                                            Print Report
                                                        </a>
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="modal" tabindex="-1" role="dialog"
                                                 id="mockdesk_ticket_close_modal">
                                                <div class="modal-dialog mt-5" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Close ticket</h5>
                                                            <button type="button" class="btn-close"
                                                                    data-bs-dismiss="modal"
                                                                    aria-label="Close"/>
                                                        </div>
                                                        <div class="modal-body">
                                                            <p>Are you sure you wish to closed ticket?</p>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <a role="button" class="btn btn-primary"
                                                               t-attf-href="/my/ticket/close/#{ticket.id}">
                                                                Close the ticket
                                                            </a>
                                                            <button type="button" class="btn btn-light"
                                                                    data-bs-dismiss="modal">
                                                                Discard
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-lg-8">
                                <div class="card mb-4">
                                    <div id="card_header" class="card-header container" data-anchor="true">
                                        <div class="row gs-0">
                                            <div class="col-md">
                                                <h5 class="row mx-1 mb-1 mb-md-0">
                                                    <div class="col-9 text-truncate">
                                                        <span t-field="ticket.name" t-att-title="ticket.name"/>
                                                        <small class="text-muted ">(#
                                                            <span t-field="ticket.ref"/>
                                                            )
                                                        </small>
                                                    </div>
                                                    <div class="col-3 text-end">
                                                        <small class="text-end">Stage:</small>
                                                        <span t-out="ticket.stage_id.name"
                                                              t-if="ticket.is_closed"
                                                              class=" badge rounded-pill text-bg-danger"/>
                                                        <span t-out="ticket.stage_id.name"
                                                              t-else=""
                                                              class=" badge rounded-pill text-bg-info"/>
                                                    </div>
                                                </h5>
                                            </div>
                                        </div>
                                    </div>
                                    <table class="table tg" style="table-layout: fixed; width: 100%">
                                        <!--                        <thead>-->
                                        <!--                            <tr>-->
                                        <!--                                <th class="tg-ijrz" colspan="4">CUSTOMER INFORMATION</th>-->
                                        <!--                            </tr>-->
                                        <!--                        </thead>-->
                                        <tbody>
                                            <tr>
                                                <td class="tg-ozrm" colspan="4"
                                                    style="background-color:#4b4c59;color:#ffffff;">
                                                    <span style="font-weight:bold">CUSTOMER INFORMATION</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="tg-mcqj" style="font-weight: bolder;">Customer name:</td>
                                                <td class="tg-73oq">
                                                    <t t-esc="ticket.customer_id.name"/>
                                                </td>
                                                <td class="tg-mcqj" style="font-weight: bolder;">Location / Department:
                                                </td>
                                                <td class="tg-73oq">
                                                    <t t-esc="ticket.customer_id.country_id.name"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="tg-mcqj" style="font-weight: bolder;">Company:</td>
                                                <td class="tg-73oq">
                                                    <t t-esc="ticket.customer_id.company_name"/>
                                                </td>
                                                <td class="tg-mcqj" style="font-weight: bolder;">E-mail:</td>
                                                <td class="tg-73oq">
                                                    <t t-esc="ticket.customer_id.email"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="tg-mcqj" style="font-weight: bolder;">Phone number:</td>
                                                <td class="tg-73oq">
                                                    <t t-esc="ticket.customer_id.phone"/>
                                                </td>
                                                <td class="tg-mcqj" style="font-weight: bolder;">Date Created:</td>
                                                <td class="tg-73oq">
                                                    <t t-out="ticket.create_date"
                                                       t-options="{'widget': 'datetime', 'hide_seconds': True}"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="tg-ozrm" colspan="4"
                                                    style="background-color:#4b4c59;color:#ffffff;">
                                                    <span style="font-weight:bold">GENERAL INFORMATION</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="tg-mcqj" style="font-weight: bolder;">Product name:</td>
                                                <td class="tg-73oq">
                                                    <t t-esc="ticket.product_ticket_id.product_name"/>
                                                </td>
                                                <td class="tg-mcqj" style="font-weight: bolder;">Software version:</td>
                                                <td class="tg-73oq">
                                                    <t t-esc="ticket.product_version"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="tg-mcqj" style="font-weight: bolder;">Project name:</td>
                                                <td class="tg-73oq" colspan="3">
                                                    <t t-esc="ticket.project_id.project_name"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="tg-73oq">
                                                    <span style="font-weight: bolder;">Priorty:</span>
                                                </td>
                                                <td class="tg-73oq text-muted" colspan="3"
                                                    t-if="ticket.priority == '0' ">
                                                    Not Rated
                                                </td>
                                                <td class="tg-73oq text-success" colspan="3"
                                                    t-if="ticket.priority == '1' ">
                                                    Minor
                                                </td>
                                                <td class="tg-73oq text-warning" colspan="3"
                                                    t-if="ticket.priority == '2' ">
                                                    Major
                                                </td>
                                                <td class="tg-73oq text-danger" colspan="3"
                                                    t-if="ticket.priority == '3' ">
                                                    Critical
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="tg-mcqj" style="height: 60px;font-weight: bolder;">Request
                                                    Ticket Description:
                                                </td>
                                                <td class="tg-73oq" colspan="3">
                                                    <t t-raw="ticket.description"/>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Chatter-->
                    <div id="sale_order_communication" class="container py-5" data-anchor="true">
                        <t t-call="portal.message_thread">
                            <!--Lấy object ticket hiện tại-->
                            <xpath expr="//div[@id='discussion']" position="attributes">
                                <attribute name="t-att-data-display_rating">display_rating or False</attribute>
                                <t t-set="object" t-value="ticket"/>
                            </xpath>
                        </t>
                    </div>
                </section>
            </t>
        </xpath>
    </template>

    <!--    Account View-->
</odoo>